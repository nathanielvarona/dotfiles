# ====================================================================
# Global Git Configuration (XDG-compliant)
# ====================================================================
# This file acts as the main entry point for all Git configuration.
# Identity- or context-specific settings are delegated via includeIf
# to keep this file minimal, DRY, and easy to reason about.
# ====================================================================


# --------------------------------------------------------------------
# Conditional Includes — Personal / OSS Context
# --------------------------------------------------------------------
# All paths below intentionally share the same identity and settings.
# This avoids duplication by reusing `personal.gitconfig` everywhere
# personal credentials or OSS contributions are expected.
# --------------------------------------------------------------------

# Personal projects (private or public)
[includeIf "gitdir:~/Projects/personal/"]
	path = ~/.config/git/personal.gitconfig

# Open-source contributions
[includeIf "gitdir:~/Projects/contribute/"]
	path = ~/.config/git/personal.gitconfig

# Password Store (GnuPG-encrypted Git repo)
[includeIf "gitdir:~/.password-store/"]
	path = ~/.config/git/personal.gitconfig

# Homebrew taps (Git repos under Homebrew)
[includeIf "gitdir:/usr/local/Homebrew/Library/Taps/"]
	path = ~/.config/git/personal.gitconfig


# --------------------------------------------------------------------
# Conditional Includes — Other / Misc Context
# --------------------------------------------------------------------
# Used for repositories that do not clearly fall under personal
# or work identities but still require a separate configuration.
# --------------------------------------------------------------------
[includeIf "gitdir:~/Projects/others/"]
	path = ~/.config/git/others.gitconfig


# --------------------------------------------------------------------
# Conditional Includes — Work / Organization Context
# --------------------------------------------------------------------
# Corporate or organization-owned repositories with distinct
# credentials, signing keys, or workflow preferences.
# --------------------------------------------------------------------
[includeIf "gitdir:~/Projects/work/"]
	path = ~/.config/git/work.gitconfig


# ====================================================================
# Core Behavior
# ====================================================================

[core]
	# Global ignore file shared across all repositories
	excludesfile = ~/.gitignore_global

	# Use delta as the default pager for diffs and logs
	pager = delta


# ====================================================================
# Diff / Pager Enhancements (delta)
# ====================================================================

[interactive]
	# Ensure interactive commands (add -p, rebase -i) use delta
	diffFilter = delta --color-only

[delta]
	# Navigate diff sections using `n` / `N`
	navigate = true

	# Display line numbers for easier reference
	line-numbers = true

	# Theme auto-detection is enabled by default
	# dark = true
	# light = true

[diff]
	# Highlight moved lines instead of marking them deleted/added
	colorMoved = default

	# Show submodule commit summaries in diffs
	submodule = log

	# Default diff tool
	tool = meld
	guitool = meld


# ====================================================================
# Diff Tools
# ====================================================================

[difftool]
	# Do not prompt before launching difftools
	prompt = false

[difftool "sourcetree"]
	cmd = opendiff "$LOCAL" "$REMOTE"
	path =

[difftool "meld"]
	trustExitCode = true
	cmd = open -W -a /Applications/Meld.app/Contents/MacOS/Meld \
	      --args "$LOCAL" "$REMOTE"


# ====================================================================
# Merge Tools
# ====================================================================

[merge]
	# Show base version during conflicts
	conflictstyle = diff3
	tool = meld

[mergetool]
	# Disable confirmation prompts after merge
	prompt = false

[mergetool "sourcetree"]
	trustExitCode = true
	cmd = /Applications/Sourcetree.app/Contents/Resources/opendiff-w.sh \
	      "$LOCAL" "$REMOTE" -ancestor "$BASE" -merge "$MERGED"

[mergetool "meld"]
	trustExitCode = true
	cmd = open -W -a /Applications/Meld.app/Contents/MacOS/Meld \
	      --args --auto-merge "$LOCAL" "$BASE" "$REMOTE" \
	      --output="$MERGED"


# ====================================================================
# Commit & Status
# ====================================================================

[commit]
	# Standardized commit message template
	template = ~/.stCommitMsg

[status]
	# Display submodule summaries in `git status`
	submoduleSummary = true


# ====================================================================
# Git LFS
# ====================================================================
# Required for repositories using Git Large File Storage.
# --------------------------------------------------------------------

[filter "lfs"]
	clean = git-lfs clean -- %f
	smudge = git-lfs smudge -- %f
	process = git-lfs filter-process
	required = true


# ====================================================================
# Aliases
# ====================================================================

[alias]
	# Push including updated submodules
	spush = push --recurse-submodules=on-demand

	# Compact graph log (short)
	lg1 = log --graph --abbrev-commit --decorate \
	      --format=format:'%C(bold blue)%h%C(reset) - %C(bold green)(%ar)%C(reset) %C(white)%s%C(reset) %C(dim white)- %an%C(reset)%C(bold yellow)%d%C(reset)' \
	      --all

	# Detailed graph log (with dates)
	lg2 = log --graph --abbrev-commit --decorate \
	      --format=format:'%C(bold blue)%h%C(reset) - %C(bold cyan)%aD%C(reset) %C(bold green)(%ar)%C(reset)%C(bold yellow)%d%C(reset)%n          %C(white)%s%C(reset) %C(dim white)- %an%C(reset)' \
	      --all

	# Alias for preferred log format
	tlog = !"git lg1"

	# Tree-style commit history
	tree = forest --pretty=format:"%C(red)%h %C(magenta)(%ar) %C(blue)%an %C(reset)%s" --style=15 --reverse


# ====================================================================
# Credentials
# ====================================================================

[credential]
	# Clear default helpers to avoid conflicts
	helper =

	# Git Credential Manager (Homebrew-installed)
	helper = /usr/local/share/gcm-core/git-credential-manager

# Azure DevOps requires HTTP path scoping
[credential "https://dev.azure.com"]
	useHttpPath = true


# ====================================================================
# Optional SSH Preference (Disabled)
# ====================================================================
# Uncomment to force SSH for GitHub instead of HTTPS.
#
# [url "git@github.com:"]
#     insteadOf = https://github.com/
