# Set Terminal Color
set-option -ga terminal-overrides ",xterm-256color:Tc"

# Enable Mouse
set -g mouse on

# Image Rendering Support
set -gq allow-passthrough on
set -g visual-activity off

# Remap TMUX Prefix Key
set-option -g prefix C-]
bind-key C-] send-prefix

# Reload TMUX Configuration
unbind r
bind r source-file ~/.config/tmux/tmux.conf\; display 'TMUX Configuraion Reloaded!'

# Start windows and panes at 1, not 0
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# Split Panes
bind | split-window -h
bind - split-window -v

# Maximize Active Pane
bind -r m resize-pane -Z

# Set vi-mode for copy mode
set -g mode-keys vi
set -s copy-command 'pbcopy'

# Bind keys for copy mode (optional, but recommended for consistency)
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle

# Search Mode
bind -n C-f copy-mode \; send-key ?
# Use a bold orange background and dark foreground for the current search match
set-window-option -g copy-mode-current-match-style "bg=#FE8019,fg=#3C3836,bold"
# Use a different style for other search matches
set-window-option -g copy-mode-match-style "bg=#A89984,fg=#3C3836"

# Plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'aserowy/tmux.nvim'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'hendrikmi/tmux-cpu-mem-monitor'
set -g @plugin 'catppuccin/tmux'

# Custom Colors
thm_bg="#0d1117"

# Configure Catppuccin
set -g @catppuccin_flavor 'mocha'
set -g @catppuccin_status_background "$thm_bg"
set -g @catppuccin_window_status_style "none"

# Status Bar
set -g status-position bottom
set -g status-justify "left"
set -g status-left-length 100
set -g status-right-length 100

set -g status-left "#{?client_prefix,#{#[bg=$thm_bg,fg=#{@thm_teal},bold]  #S },#{#[bg=$thm_bg,fg=#{@thm_overlay_1}]  #S }} #[bg=$thm_bg,fg=#{@thm_overlay_0}]│"
set -g status-right "#[bg=$thm_bg,fg=#{@thm_surface_2}]  #{cpu}  #{mem} 󰋊 #{disk} #{battery_icon} #{battery_percentage} 󰭦 %Y-%m-%d 󰅐 %H:%M/%I:%M %p "

# Pane Border
setw -g pane-border-status bottom
setw -g pane-border-format ""
setw -g pane-border-lines single

# Window
set -wg automatic-rename on
set -g automatic-rename-format "Window"

set -g window-status-format " #I#{?#{!=:#{window_name},Window}, #W,} "
set -g window-status-style "bg=$thm_bg fg=#{@thm_surface_2}"
set -g window-status-current-format " #I#{?#{!=:#{window_name},Window}, #W,} "
set -g window-status-current-style "bg=$thm_bg,fg=#{@thm_subtext_0},bold"
set -g window-status-separator "#[bg=$thm_bg,fg=#6c7086]│"

# aserowy/tmux.nvim
# navigation
set -g @tmux-nvim-navigation false
# resize
set -g @tmux-nvim-resize true
set -g @tmux-nvim-resize-step-x 1
set -g @tmux-nvim-resize-step-y 1
set -g @tmux-nvim-resize-keybinding-left 'M-h'
set -g @tmux-nvim-resize-keybinding-down 'M-j'
set -g @tmux-nvim-resize-keybinding-up 'M-k'
set -g @tmux-nvim-resize-keybinding-right 'M-l'

# christoomey/vim-tmux-navigator
set -g @vim_navigator_mapping_left "C-Left C-h"  # use C-h and C-Left
set -g @vim_navigator_mapping_right "C-Right C-l"
set -g @vim_navigator_mapping_up "C-k"
set -g @vim_navigator_mapping_down "C-j"
set -g @vim_navigator_mapping_prev ""  # removes the C-\ binding

set -g @vim_navigator_prefix_mapping_clear_screen ""

# Change the regular expression used to detect vim. This pattern must be
# compatible with `grep -iE` extended regular expression syntax.
set -g @vim_navigator_pattern '(\S+/)?g?\.?(view|l?n?vim?x?|fzf)(diff)?(-wrapped)?'

# Override the shell script logic for detecting vim. Instances of
# '@vim_navigator_pattern' will automatically be substituted with your override
# of '@vim_navigator_pattern', or it will use the default @vim_navigator_pattern
# if you haven't overridden the option.
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
  | grep -iqE '^[^TXZ ]+ +@vim_navigator_pattern$'"
set -g @vim_navigator_check "${is_vim}"

# Initialize TMUX plugin manager
run '~/.config/tmux/plugins/tpm/tpm'

